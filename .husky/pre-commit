#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if there are staged files
if git diff --cached --quiet; then
  echo "ğŸ”„ Staged files detected, running workflow..."
  
  # 1. Generate types first (may update sanity.types.ts)
  echo "ğŸ“ Generating Sanity types..."
  pnpm run typegen
  
  # 2. Add generated types to staging if they were updated
  if git diff --quiet sanity.types.ts; then
    git add sanity.types.ts
    echo "âœ… Added updated types to staging"
  fi
  
  # 3. Format all files (including newly generated types)
  echo "ğŸ¨ Formatting files..."
  pnpm run format
  
  # 4. Add formatted files to staging
  git add .
  
  # 5. Final lint check
  echo "ğŸ” Running lint check..."
  pnpm run lint:check
  
  echo "âœ… Pre-commit workflow complete"
else
  echo "â„¹ï¸  No staged files, skipping pre-commit workflow"
fi
